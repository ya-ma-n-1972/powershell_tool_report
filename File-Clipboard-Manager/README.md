# File Clipboard Manager

> **⚠️ 重要な更新（2025-11-02）**: v1.0.0にバグが発見されました。既にダウンロードされた方は、最新版（v1.0.1）への更新をお願いします。詳細は[バージョン履歴](#バージョン履歴)をご確認ください。

複数のファイルをグループ管理し、クリップボードに一括登録できるPowerShellツールです。

## 主な機能

### ファイル管理
- **4つのグループで最大80ファイル管理**（各グループ20ファイルまで）
  - Claude AIのファイルアップロード制限（1チャットあたり最大20ファイル）に対応
- ファイルパスの永続化（JSON形式で保存）
- グループ間のファイル移動
- グループ名のカスタマイズ
- ファイルサイズの自動計算・表示
  - Claude AIのファイルサイズ制限（合計最大30MB）の確認に便利

### クリップボード登録
1. **ファイルパス方式**
   - エクスプローラーに貼り付け可能な形式でクリップボードに登録
   - 複数ファイルの一括コピーに便利

2. **フェンス付きテキスト方式**
   - ファイル内容をMarkdown形式（```）で囲んでテキストとして登録
   - 個別ファイルまたはグループ全体を一度に登録可能
   - Claude AIなどのチャットボットへのコード送信に最適

### その他の機能
- **BOM付きUTF-8変換**: 選択したテキストファイルをBOM付きUTF-8に変換
- **WSLファイル対応**: `\\wsl.localhost\`形式のパスもサポート
- **直感的なUI**: メッセージ表示エリアで操作結果を即座に確認

## 動作環境

- Windows 10/11
- PowerShell 5.1 以降
- .NET Framework（Windows標準搭載）

## インストール

1. リポジトリをクローンまたはダウンロード
2. `File-Clipboard-Manager.ps1`を任意のフォルダに配置

## 使い方

### 起動

PowerShellから以下のコマンドを実行：

```powershell
.\File-Clipboard-Manager.ps1
```

または、エクスプローラーから右クリック → **「PowerShellで実行」**

### 基本操作

#### 1. ファイルの追加

1. メインウィンドウで対象グループの**「設定」**ボタンをクリック
2. **「ファイル追加」**ボタンをクリック
3. ファイル選択ダイアログからファイルを選択
4. **「OK」**ボタンで保存

#### 2. クリップボードへ登録（ファイルパス方式）

1. メインウィンドウで対象グループの**「クリップボードへ」**ボタンをクリック
2. エクスプローラーなどに貼り付け（Ctrl+V）

#### 3. フェンス付きでクリップボードへ登録（テキスト方式）

**グループ全体を登録:**
1. メインウィンドウで対象グループの**「フェンス付きでクリップボード」**ボタンをクリック
2. テキストエディタやチャットに貼り付け（Ctrl+V）

**個別ファイルを登録:**
1. 設定ウィンドウでファイルを選択
2. **「フェンス追加」**ボタンをクリック
3. テキストエディタやチャットに貼り付け（Ctrl+V）

#### 4. ファイルの削除

- **個別削除**: 設定ウィンドウでファイルを選択 → **「選択ファイルを削除」**
- **一括削除**: 設定ウィンドウで**「全て削除」**ボタンをクリック

#### 5. グループ間でファイルを移動

1. 設定ウィンドウでファイルを選択
2. **「別グループへ移動」**ボタンをクリック
3. 移動先グループを選択

#### 6. BOM付きUTF-8へ変換

1. 設定ウィンドウで**「BOM変換」**ボタンをクリック
2. 各ファイルごとに確認ダイアログで「はい」を選択

> **注意**: バックアップは作成されません。重要なファイルは事前にバックアップしてください。

## ファイル構成

```
File-Clipboard-Manager/
├── File-Clipboard-Manager.ps1  # メインスクリプト
├── config.json                  # 設定ファイル（自動生成）
└── README.md                    # このファイル
```

## 設定ファイル（config.json）

初回起動時に自動生成されます。手動編集も可能です。

```json
{
  "groups": [
    {
      "name": "グループ1",
      "files": [
        "C:\\path\\to\\file1.txt",
        "C:\\path\\to\\file2.txt"
      ]
    },
    {
      "name": "グループ2",
      "files": []
    },
    ...
  ]
}
```

## 使用例

### 例1: プロジェクトファイルをClaude AIに送信

1. グループ1に主要なソースコードファイルを登録
2. **「フェンス付きでクリップボード」**をクリック
3. Claude AIのチャット画面に貼り付け
4. コードレビューやリファクタリングを依頼

### 例2: 複数のログファイルを別フォルダにコピー

1. グループ2にログファイルを登録
2. **「クリップボードへ」**をクリック
3. エクスプローラーで目的のフォルダを開く
4. Ctrl+V で貼り付け

### 例3: WSL内のファイルを管理

```
\\wsl.localhost\Ubuntu-22.04\home\user\project\main.py
\\wsl.localhost\Ubuntu-22.04\home\user\project\utils.py
```

このようなWSLパスも通常のWindowsパスと同様に扱えます。

## トラブルシューティング

### スクリプトが実行できない

PowerShellの実行ポリシーを確認してください：

```powershell
# 現在のポリシーを確認
Get-ExecutionPolicy

# 実行を許可（管理者権限が必要）
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### ファイルが見つからない

- ファイルパスが正しいか確認
- ネットワークドライブやUSBドライブが接続されているか確認
- WSLパスの場合、WSLが起動しているか確認

### クリップボードに登録されない

- 他のアプリがクリップボードを使用していないか確認
- Windowsを再起動してみる

## 使用上の注意事項

本ツールは個人のローカル環境での使用を想定した設計となっています。以下の点にご注意ください。

### Claude AIのアップロード制限について

本ツールの設計は、Claude AIのファイルアップロード制限を考慮しています：

- **ファイル数制限**: 1チャットあたり最大20ファイル
  - 各グループの最大ファイル数を20に設定
- **ファイルサイズ制限**: 合計最大30MB
  - グループサイズの自動計算機能でサイズ確認が可能

### ファイルサイズについて
ファイルサイズの上限チェックは実装していません。数GB単位の巨大なファイルを読み込むとメモリ不足でクラッシュする可能性があります。主にソースコードや設定ファイルなど、比較的小さなテキストファイルでの使用を推奨します。

Claude AIへファイルをアップロードする際は、グループサイズが30MBを超えないように注意してください。超過する場合は、複数のグループに分割するか、ファイルを絞り込んでください。

### BOM付きUTF-8変換について
「BOM変換」機能はファイルを直接上書きします。バックアップは作成されませんので、重要なファイルを変換する際は事前に手動でバックアップを取ってください。

### 設定ファイルの扱い
config.jsonは手動編集も可能ですが、JSON形式が不正な場合はデフォルト設定にリセットされます。手動編集後は必ずツールを起動して正常に読み込まれることを確認してください。

### セキュリティについて
本ツールはネットワーク通信を行わず、ローカルファイルシステムのみを操作します。ただし、任意のファイルパスにアクセス可能な設計のため、信頼できない第三者が作成したconfig.jsonファイルを使用しないでください。

### 想定外の使用環境
本ツールは個人利用を前提としています。企業環境での配布や、不特定多数が使用する環境での利用は想定していません。そのような用途で使用する場合は、適切なセキュリティレビューと改修を行ってください。

## ライセンス

MIT License

## 作者

ya-man

## バージョン履歴

### v1.0.1 (2025-11-02)
**バグ修正**
- ファイル削除・移動時の配列処理エラーを修正
  - 複数ファイル登録後、「選択ファイルを削除」で1つずつ削除し、新しいファイルを追加すると、2つ目以降のファイルパスが1つ目に連結される問題を修正
  - PowerShellの配列がスカラー値に変換される問題に対応（`@()` 配列サブ式演算子を使用）
  - 修正箇所：選択ファイル削除処理（521-523行目）、ファイル移動処理（309-311行目）

**技術的詳細**
```powershell
# 修正前
$script:config.groups[$groupIndex].files =
    $script:config.groups[$groupIndex].files | Where-Object { $_ -ne $selectedFilePath }

# 修正後
$script:config.groups[$groupIndex].files = @(
    $script:config.groups[$groupIndex].files | Where-Object { $_ -ne $selectedFilePath }
)
```

PowerShellでは、`Where-Object`で要素をフィルタリングした結果が1つだけになった場合、配列ではなく文字列に自動変換されます。`@()`で囲むことで、結果が1要素でも0要素でも必ず配列型として維持されます。

### v1.0.0 (2025-10-31)
- 初回リリース
- 4グループ管理機能
- ファイルパス方式のクリップボード登録
- フェンス付きテキスト方式のクリップボード登録
- グループ間ファイル移動
- BOM付きUTF-8変換
- WSLファイルパス対応
