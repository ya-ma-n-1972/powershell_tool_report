# Get-PathTree

Windows/WSL2両対応のフォルダツリー生成ツール - GUIで簡単操作、コメント記号付きツリー出力

## 特徴

- **Windows/WSL2両対応** - ローカルフォルダもWSL環境も1つのツールで
- **GUIで直感操作** - チェックボックスで出力項目を選択
- **コメント対応** - 自動で `//` を整列させて付与
- **編集可能** - 生成後のツリーを直接編集
- **PowerShellネイティブ** - 追加インストール不要

## 出力例

```
MyProject/                        //
├── docs/                         //
│   ├── manual.pdf                //
│   └── readme.txt                //
├── src/                          //
│   ├── main.js                   //
│   └── style.css                 //
├── tests/                        //
│   └── test_main.js              //
├── .gitignore                    //
├── package.json                  //
└── README.md                     //
```

## クイックスタート

```powershell
# 実行（管理者権限不要）
.\Get-PathTree.ps1
```

### 基本的な使い方

1. **パス入力** - WindowsパスまたはWSLパスを入力
2. **読み込み** - フォルダ構造を取得
3. **選択** - チェックボックスで出力項目を選択  
4. **生成** - ツリーを作成してコピー

## 動作環境

- Windows 10/11
- PowerShell 5.1以降
- WSL2（WSL機能使用時のみ）
- .NET Framework（Windows標準）

## 使用例

### Windowsフォルダ
```
C:\Users\Documents
D:\Projects\MyProject
```

### WSL2フォルダ
```
/home/user/projects
\\wsl.localhost\Ubuntu\home\user
```

## 注意事項

### WSL2使用時
- **初回起動**: PowerShellで `wsl` を実行してWSL2を起動してから使用
- **ルート制限**: ディストリビューションのルート（`/`）は選択不可
- **パフォーマンス**: **深度4以上は処理が大幅に遅くなります**（推奨: 深度2-3）
  - WSL2はWindows-Linux間の通信オーバーヘッドがあるため
  - 大規模ディレクトリは特に時間がかかります
  - 応答がない場合は深度を下げて再実行してください

### 表示互換性
| 正常表示 | 要調整 |
|----------|--------|
| GitHub | 一部のWebエディタ |
| メモ帳 | VSCode Copilot Chat |
| Markdownファイル | プロジェクト直接入力 |

### その他
- **全角文字**: フォルダ名に日本語等を含む場合、コメント位置の手動調整が必要な場合があります
- **折りたたみ**: ツリービューで折りたたんだ項目の子要素は出力されません

## トラブルシューティング

| 問題 | 解決方法 |
|------|---------|
| WSLパスでエラー | `wsl --list --running` でWSL2起動を確認 |
| WSL2で応答なし | **深度を2-3に下げて再実行**（深度4以上は非推奨） |
| ツリーが不完全 | ツリービューで該当項目を展開してから生成 |
| 読み込みが遅い | Windows: 深度3-5 / **WSL2: 深度2-3**に制限 |

## 高度な使い方

- **深度設定**: 
  - Windows環境: 1-10階層（推奨: 3-5）
  - **WSL2環境: 1-10階層（推奨: 2-3、4以上は非推奨）**
- **ファイル除外**: チェックを外してディレクトリのみ出力
- **一括選択**: 「全選択」「全解除」ボタンで効率化
- **編集**: 生成後のツリーを編集エリアで直接修正

## パフォーマンスのヒント

### WSL2での最適化
- **具体的なパスを指定**: `/home/user/specific_project` のように深い階層から開始
- **ファイルを除外**: 「ファイルを含む」のチェックを外してディレクトリのみ取得
- **段階的な探索**: まず深度2で全体を確認、必要な箇所のみ深度を上げる

## 更新履歴

### v2.0 (2025-11-15)

#### 🎯 主要な改善

**WSLディストリビューション指定対応**
- UNCパス（`\\wsl.localhost\Ubuntu-22.04\...`）から正しいディストリビューションを自動判定
- `wsl -d` フラグで明示的にディストリビューションを指定して実行
- 複数のWSLディストリビューション環境でも正確に動作

**安定性の向上**
- ディレクトリ・ファイルの列挙順序をアルファベット順に統一
- 実行ごとに結果が変わる問題を解消
- Windows/WSL両環境で一貫した出力を保証

**安全性の向上**
- ジャンクション・シンボリックリンクを自動除外
- 循環参照による無限ループを防止
- 予期しない巨大ツリーの展開を回避

**コード品質の改善**
- スコープ管理の最適化（セッションスコープの汚染を防止）
- 関数をScriptBlock化してメモリ効率を向上
- 再利用性と保守性の向上

#### 📝 ドキュメント改善
- コメントの一貫性と可読性を向上
- GitHub公開に向けた品質改善

#### 🔧 技術的詳細
詳細な変更内容は [リファクタリング記録.md](./リファクタリング記録.md) を参照してください。

---

## ライセンス

MIT License

## 貢献

Issue・Pull Request歓迎です
